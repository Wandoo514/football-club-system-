<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Wandoo United FC ‚Äî Dashboard</title>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  :root{
    --bg:#071226;
    --card:#081426;
    --glass: rgba(255,255,255,0.03);
    --accent:#00d084;
    --accent2:#2dd4bf;
    --muted:#9aa4b2;
    --danger:#ff6b6b;
    --glass-2: rgba(255,255,255,0.02);
    --text:#e6eef6;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:
    radial-gradient(1200px 600px at 10% 10%, rgba(34,197,94,0.04), transparent 8%),
    radial-gradient(1000px 400px at 90% 90%, rgba(45,212,191,0.03), transparent 12%),
    var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
  header{padding:18px;display:flex;align-items:center;gap:12px;max-width:1100px;margin:12px auto}
  .logo-box{width:64px;height:64px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;color:#042; font-weight:700;box-shadow:0 6px 24px rgba(0,0,0,0.6)}
  h1{margin:0;font-size:18px}
  .sub{color:var(--muted);font-size:13px;margin-top:4px}

  .wrap{max-width:1100px;margin:0 auto;padding:12px;display:grid;grid-template-columns:260px 1fr;gap:18px}
  /* SIDEBAR */
  .sidebar{background:linear-gradient(180deg,var(--card),var(--glass));border-radius:12px;padding:14px;backdrop-filter:blur(6px);box-shadow:0 10px 30px rgba(2,6,23,0.6)}
  .profile{display:flex;gap:10px;align-items:center}
  .avatar{width:56px;height:56px;border-radius:10px;background:var(--glass);display:flex;align-items:center;justify-content:center;overflow:hidden}
  .avatar img{width:100%;height:100%;object-fit:cover}
  .who{flex:1}
  .who h3{margin:0;font-size:15px}
  .who p{margin:0;color:var(--muted);font-size:13px}

  .sidebar .nav{margin-top:12px;display:flex;flex-direction:column;gap:8px}
  .nav button{background:transparent;color:var(--text);border:0;padding:10px 12px;border-radius:8px;text-align:left;cursor:pointer;font-size:14px;display:flex;align-items:center;gap:8px}
  .nav button.active{background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));box-shadow: inset 0 1px 0 rgba(255,255,255,0.02)}
  .small{font-size:13px;color:var(--muted)}

  /* Main area */
  .main{display:flex;flex-direction:column;gap:14px}
  .cards{display:flex;gap:12px;flex-wrap:wrap}
  .card{flex:1;min-width:180px;background:linear-gradient(180deg,var(--glass),var(--glass-2));padding:14px;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,0.5)}
  .card h4{margin:0;font-size:13px;color:var(--muted)}
  .card .big{font-size:22px;margin-top:8px;color:var(--text);font-weight:700}

  .grid{display:grid;grid-template-columns:1fr 360px;gap:12px}
  .panel{background:linear-gradient(180deg,var(--glass),rgba(255,255,255,0.01));padding:14px;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,0.45)}
  .flex{display:flex;gap:8px;align-items:center}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);font-size:14px;color:var(--text)}
  th{color:var(--muted);font-weight:600;text-transform:uppercase;font-size:12px}
  .btn{padding:8px 10px;border-radius:8px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#042;cursor:pointer;font-weight:600}
  .btn.ghost{background:transparent;color:#cfeee4;border:1px solid rgba(255,255,255,0.03)}
  .btn.danger{background:linear-gradient(90deg,var(--danger),#ff8474);color:#fff}
  input, select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text)}
  .muted{color:var(--muted)}

  /* toast */
  #toast{position:fixed;right:18px;bottom:18px;background:rgba(2,6,23,0.9);color:#dffaf0;padding:10px 14px;border-radius:10px;box-shadow:0 8px 30px rgba(2,6,23,0.6);display:none;align-items:center;gap:8px}
  #toast.play{display:flex;animation:toastIn .35s ease}
  @keyframes toastIn{from{transform:translateY(12px);opacity:0}to{transform:none;opacity:1}}
  @media (max-width:980px){
    .wrap{grid-template-columns:1fr; padding-bottom:60px}
    .grid{grid-template-columns:1fr}
    .sidebar{order:2}
  }
  .uploader{display:flex;gap:8px;align-items:center}
  .logo-preview{width:56px;height:56px;border-radius:8px;overflow:hidden;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center}
  .logo-preview img{width:100%;height:100%;object-fit:cover}
  .chart-wrap{height:220px;display:flex;align-items:center}
  .pill{background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:999px;font-weight:600;color:var(--text)}
  .toast-sound{display:none}
</style>
</head>
<body>

<header>
  <div style="max-width:1100px;margin:0 auto;display:flex;gap:12px;align-items:center;justify-content:space-between">
    <div style="display:flex;gap:12px;align-items:center">
      <div class="logo-box">WU</div>
      <div>
        <h1>Wandoo United FC</h1>
        <div class="sub">Modern dashboard ‚Äî demo (client-side)</div>
      </div>
    </div>
    <div style="display:flex;gap:10px;align-items:center">
      <div id="topRole" class="pill">GUEST</div>
      <div id="topUser" class="small muted">Not signed in</div>
    </div>
  </div>
</header>

<main class="wrap">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="profile">
      <div class="avatar" id="logoAvatar" title="Team logo">
        <span id="avatarInitials" style="font-weight:700;color:#042">WU</span>
      </div>
      <div class="who">
        <h3 id="userName">Guest</h3>
        <p class="small" id="userRole">Role: viewer</p>
      </div>
    </div>

    <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
      <div class="uploader" style="flex:1">
        <input id="logoInput" type="file" accept="image/*" style="display:none"/>
        <button class="btn ghost" id="uploadBtn">Upload Logo</button>
        <div class="logo-preview" id="logoPreview" title="Uploaded logo" style="margin-left:auto"></div>
      </div>
    </div>

    <div class="nav" style="margin-top:16px">
      <button class="active" data-section="dashboard">üìä Dashboard</button>
      <button data-section="players">üèÉ Players</button>
      <button data-section="matches">üìÖ Matches</button>
      <button data-section="settings">‚öôÔ∏è Settings</button>
    </div>

    <div style="margin-top:12px">
      <div style="display:flex;gap:8px">
        <button class="btn" id="loginOpenBtn">Sign in</button>
        <button class="btn ghost" id="logoutBtn" style="display:none">Sign out</button>
      </div>
      <p class="small muted" style="margin-top:8px">Demo users: admin/1234 ‚Ä¢ manager/5678 ‚Ä¢ viewer/0000</p>
    </div>
  </aside>

  <!-- MAIN -->
  <section class="main">
    <!-- CARDS -->
    <div class="cards">
      <div class="card">
        <h4>Total players</h4>
        <div class="big" id="cardPlayers">0</div>
        <div class="muted small">Live count of registered players</div>
      </div>
      <div class="card">
        <h4>Total goals</h4>
        <div class="big" id="cardGoals">0</div>
        <div class="muted small">Sum of all goals</div>
      </div>
      <div class="card">
        <h4>Player of the month</h4>
        <div class="big" id="cardPOM">‚Äî</div>
        <div class="muted small">Auto-select top scorer or set manually</div>
      </div>
    </div>

    <!-- GRID -->
    <div class="grid">
      <!-- LEFT: players / matches / dashboard content -->
      <div>
        <!-- DASHBOARD -->
        <div id="section-dashboard" class="panel" style="display:block">
          <h3>Overview</h3>
          <div class="chart-wrap card">
            <canvas id="goalsChart"></canvas>
          </div>
          <div style="display:flex;gap:8px;margin-top:10px">
            <button class="btn" id="autoPOM">Auto-select POM</button>
            <button class="btn ghost" id="clearPOM">Clear POM</button>
          </div>
        </div>

        <!-- PLAYERS -->
        <div id="section-players" class="panel" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
            <h3>Players</h3>
            <div style="display:flex;gap:8px">
              <input id="search" placeholder="Search by name or position" />
              <button class="btn ghost" id="refreshPlayers">Refresh</button>
            </div>
          </div>
          <table id="playersTable">
            <tr><th>Name</th><th>Position</th><th>Age</th><th>Goals</th><th>Action</th></tr>
          </table>

          <div style="margin-top:12px" id="addPlayerWrap">
            <h4>Add Player</h4>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
              <input id="p_name" placeholder="Name" />
              <input id="p_position" placeholder="Position" />
              <input id="p_age" placeholder="Age" type="number" />
              <input id="p_goals" placeholder="Goals" type="number" />
            </div>
            <div style="margin-top:8px;display:flex;gap:8px">
              <button class="btn" id="addPlayerBtn">Add player</button>
              <button class="btn ghost" id="resetPlayerBtn">Reset</button>
            </div>
          </div>
        </div>

        <!-- MATCHES -->
        <div id="section-matches" class="panel" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3>Matches</h3>
            <button class="btn" id="toggleAddMatch">‚ûï Add match</button>
          </div>

          <table id="matchesTable">
            <tr><th>Date</th><th>Team A</th><th>Team B</th><th>Score</th><th>Action</th></tr>
          </table>

          <div id="addMatchWrap" style="display:none;margin-top:10px">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
              <input id="m_date" type="date" />
              <input id="m_teamA" placeholder="Team A" />
              <input id="m_teamB" placeholder="Team B" />
              <input id="m_score" placeholder="Score (e.g. 2-1)" />
            </div>
            <div style="margin-top:8px;display:flex;gap:8px">
              <button class="btn" id="addMatchBtn">Save Match</button>
              <button class="btn ghost" id="cancelAddMatch">Cancel</button>
            </div>
          </div>
        </div>

        <!-- SETTINGS -->
        <div id="section-settings" class="panel" style="display:none">
          <h3>Settings & Export</h3>
          <div class="muted small">Local demo settings ‚Äî for production move to a secure backend</div>
          <div style="margin-top:10px">
            <label class="small muted">Stored Data</label>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn ghost" id="exportBtn">Export JSON</button>
              <button class="btn ghost" id="importBtn">Import JSON</button>
              <button class="btn danger" id="clearBtn">Clear all</button>
            </div>
            <input type="file" id="importFile" accept="application/json" style="display:none" />
            <div style="margin-top:12px">
              <button class="btn ghost" id="exportReadmeBtn">Export README</button>
              <div class="muted small" style="margin-top:8px">Click "Export README" to download a short README explaining how to paste this file to GitHub and a suggested commit message.</div>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT: small widgets -->
      <aside>
        <div class="panel">
          <h4>Account</h4>
          <div id="authBox">
            <div id="loginForm">
              <input id="loginUser" placeholder="username" />
              <input id="loginPass" placeholder="password" type="password" />
              <div style="display:flex;gap:8px;margin-top:8px">
                <button class="btn" id="loginBtn">Sign in</button>
                <button class="btn ghost" id="fillDemoBtn">Fill demo</button>
              </div>
            </div>
            <div id="loggedBox" style="display:none">
              <div class="small muted">Signed in as <b id="signedName"></b></div>
              <div class="small muted">Role: <b id="signedRole"></b></div>
              <div style="display:flex;gap:8px;margin-top:8px">
                <button class="btn ghost" id="logoutBtn2">Sign out</button>
                <button class="btn" id="impersonateBtn">Switch user</button>
              </div>
            </div>
          </div>
        </div>

        <div class="panel" style="margin-top:12px">
          <h4>Player of the Month</h4>
          <div id="pomList"></div>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button class="btn" id="autoPomBtn">Auto top scorer</button>
            <button class="btn ghost" id="clearPomBtn">Clear</button>
          </div>
        </div>

        <div class="panel" style="margin-top:12px">
          <h4>Quick actions</h4>
          <div style="display:flex;flex-direction:column;gap:8px">
            <button class="btn ghost" id="refreshAll">Refresh all</button>
            <button class="btn ghost" id="showToastDemo">Show toast</button>
            <div class="muted small">Tip: Use admin to enable deletes and POM set</div>
          </div>
        </div>
      </aside>
    </div>
  </section>
</main>

<div id="toast"><span id="toastText"></span></div>

<!-- Simple sounds via WebAudio -->
<audio id="soundAdd" class="toast-sound"></audio>
<audio id="soundDel" class="toast-sound"></audio>
<audio id="soundNotify" class="toast-sound"></audio>

<script>
/* ===========================
   Wandoo United FC ‚Äî Single-file Modern Dashboard
   Client-side only demo (localStorage)
   Includes:
   - Sample full team (11 players)
   - Demo credentials: admin/1234, manager/5678, viewer/0000
   - Chart.js, logo upload, toasts, sounds, export README
   =========================== */

const DEMO_USERS = [
  { username: 'admin', password: '1234', role: 'admin' },
  { username: 'manager', password: '5678', role: 'manager' },
  { username: 'viewer', password: '0000', role: 'viewer' }
];

const STORAGE_KEYS = {
  players: 'wu_players_v1',
  matches: 'wu_matches_v1',
  user: 'wu_user_v1',
  pom: 'wu_pom_v1',
  logo: 'wu_logo_v1'
};

// Utilities
function uid(){ return 'id_' + Math.random().toString(36).slice(2,9) }
function nowISO(){ return new Date().toISOString().slice(0,10) }

// sound helpers (WebAudio simple tone)
function playTone(freq=440, type='sine', duration=0.08){
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = type; o.frequency.value = freq;
    o.connect(g); g.connect(ctx.destination);
    g.gain.value = 0.0001;
    o.start();
    g.gain.exponentialRampToValueAtTime(0.12, ctx.currentTime + 0.01);
    g.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime + duration);
    setTimeout(()=>{ o.stop(); ctx.close(); }, duration*1000 + 20);
  } catch(e){}
}
function soundAdd(){ playTone(740,'triangle',0.09) }
function soundDel(){ playTone(220,'sawtooth',0.12) }
function soundNotify(){ playTone(520,'sine',0.08) }

// Toast
let toastTimer = null;
function toast(msg){
  const el = document.getElementById('toast'); const t = document.getElementById('toastText');
  t.textContent = msg; el.classList.add('play'); el.style.display='flex';
  soundNotify();
  if (toastTimer) clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>{ el.classList.remove('play'); el.style.display='none'; }, 2500);
}

// Load/Save storage
function load(key, fallback){ try { const raw = localStorage.getItem(key); return raw ? JSON.parse(raw) : fallback } catch(e){ return fallback } }
function save(key, val){ localStorage.setItem(key, JSON.stringify(val)) }

// Sample full team (11 players) - only used if localStorage empty
const samplePlayers = [
  { name: "Mark Njoroge", position: "Goalkeeper", age: 28, goals: 0 },
  { name: "Samuel Otieno", position: "Right Back", age: 24, goals: 1 },
  { name: "Michael Kiptoo", position: "Left Back", age: 26, goals: 2 },
  { name: "David Mwangi", position: "Center Back", age: 30, goals: 0 },
  { name: "Brian Ouma", position: "Center Back", age: 27, goals: 1 },
  { name: "Kevin Wambua", position: "Defensive Midfielder", age: 25, goals: 2 },
  { name: "Alex Wekesa", position: "Midfielder", age: 23, goals: 3 },
  { name: "John Kamau", position: "Right Winger", age: 22, goals: 8 },
  { name: "Peter Otieno", position: "Left Winger", age: 25, goals: 4 },
  { name: "Patrick Osei", position: "Striker", age: 24, goals: 10 },
  { name: "Felix Awuor", position: "Striker", age: 29, goals: 6 }
];

const sampleMatches = [
  { date: "2025-10-01", teamA: "Wandoo United", teamB: "Red Lions", score: "2-1" },
  { date: "2025-10-08", teamA: "Wandoo United", teamB: "Blue Sharks", score: "1-1" },
  { date: "2025-10-15", teamA: "Green Eagles", teamB: "Wandoo United", score: "0-3" }
];

// Initial data (load or seed)
let players = load(STORAGE_KEYS.players, null);
if (!players) {
  players = samplePlayers.map(p => ({ id: uid(), name: p.name, position: p.position, age: p.age, goals: p.goals }));
  save(STORAGE_KEYS.players, players);
}
let matches = load(STORAGE_KEYS.matches, null);
if (!matches) {
  matches = sampleMatches.map(m => ({ id: uid(), date: m.date, teamA: m.teamA, teamB: m.teamB, score: m.score }));
  save(STORAGE_KEYS.matches, matches);
}
let currentUser = load(STORAGE_KEYS.user, { username: 'Guest', role: 'viewer' });
let POM = localStorage.getItem(STORAGE_KEYS.pom) || null;
let teamLogo = localStorage.getItem(STORAGE_KEYS.logo) || null;

/* ========= UI elements & init ========= */
const topUser = document.getElementById('topUser');
const topRole = document.getElementById('topRole');
const userNameEl = document.getElementById('userName');
const userRoleEl = document.getElementById('userRole');
const logoPreview = document.getElementById('logoPreview');
const avatarInitials = document.getElementById('avatarInitials');
const logoAvatar = document.getElementById('logoAvatar');

/* ===== Navigation handling ===== */
document.querySelectorAll('.nav button').forEach(btn=>{
  btn.addEventListener('click', ()=> {
    document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const s = btn.getAttribute('data-section');
    showSection(s);
  });
});
function showSection(name){
  ['dashboard','players','matches','settings'].forEach(k=>{
    document.getElementById('section-' + k).style.display = 'none';
  });
  document.getElementById('section-' + name).style.display = 'block';
}

/* ===== Auth UI ===== */
function refreshAuthUI(){
  document.getElementById('signedName').textContent = currentUser.username || 'Guest';
  document.getElementById('signedRole').textContent = currentUser.role || 'viewer';
  topUser.textContent = currentUser.username || 'Guest';
  topRole.textContent = (currentUser.role || 'viewer').toUpperCase();
  userNameEl.textContent = currentUser.username === 'Guest' ? 'Guest' : currentUser.username;
  userRoleEl.textContent = 'Role: ' + (currentUser.role || 'viewer');
  const logged = currentUser && currentUser.username && currentUser.username !== 'Guest';
  document.getElementById('loginForm').style.display = logged ? 'none' : 'block';
  document.getElementById('loggedBox').style.display = logged ? 'block' : 'none';
  document.getElementById('logoutBtn').style.display = logged ? 'inline-block' : 'none';
  document.getElementById('logoutBtn2').style.display = logged ? 'inline-block' : 'none';
  const canAdd = ['admin','manager'].includes(currentUser.role);
  document.getElementById('addPlayerWrap').style.display = canAdd ? 'block' : 'none';
  save(STORAGE_KEYS.user, currentUser);
}

document.getElementById('fillDemoBtn').addEventListener('click', ()=>{ document.getElementById('loginUser').value = 'admin'; document.getElementById('loginPass').value = '1234'; });
document.getElementById('loginBtn').addEventListener('click', ()=> {
  const u = document.getElementById('loginUser').value.trim();
  const p = document.getElementById('loginPass').value;
  const found = DEMO_USERS.find(x=>x.username === u && x.password === p);
  if (!found) { toast('Login failed'); return; }
  currentUser = { username: found.username, role: found.role };
  save(STORAGE_KEYS.user, currentUser);
  refreshAuthUI();
  toast(`Welcome ${found.username}`);
  soundAdd();
  renderAll();
});
document.getElementById('logoutBtn').addEventListener('click', ()=> signOut());
document.getElementById('logoutBtn2').addEventListener('click', ()=> signOut());
function signOut(){
  currentUser = { username: 'Guest', role: 'viewer' };
  save(STORAGE_KEYS.user, currentUser);
  refreshAuthUI();
  toast('Signed out');
  soundDel();
  renderAll();
}
document.getElementById('impersonateBtn').addEventListener('click', ()=>{
  const u = prompt('Enter username to switch (admin, manager, viewer) ‚Äî leave blank to cancel');
  if (!u) return;
  const found = DEMO_USERS.find(x=>x.username===u);
  if (!found) return toast('Unknown user');
  const p = prompt('Password for ' + u + ':');
  if (p !== found.password) { toast('Wrong password'); return; }
  currentUser = { username: found.username, role: found.role };
  save(STORAGE_KEYS.user, currentUser);
  refreshAuthUI();
  renderAll();
  toast('Switched to ' + u);
});

/* ===== Logo upload ===== */
const logoInput = document.getElementById('logoInput');
document.getElementById('uploadBtn').addEventListener('click', ()=> logoInput.click());
logoInput.addEventListener('change', async (e)=>{
  const f = e.target.files[0];
  if (!f) return;
  const reader = new FileReader();
  reader.onload = ()=> {
    teamLogo = reader.result;
    localStorage.setItem(STORAGE_KEYS.logo, teamLogo);
    renderLogo();
    toast('Logo uploaded');
  };
  reader.readAsDataURL(f);
});
function renderLogo(){
  if (!teamLogo) {
    logoPreview.innerHTML = '<span class="small muted">No logo</span>';
    avatarInitials.style.display = 'block';
    return;
  }
  avatarInitials.style.display = 'none';
  logoPreview.innerHTML = '<img src="'+teamLogo+'" alt="logo">';
  logoAvatar.innerHTML = '<img src="'+teamLogo+'" alt="logo">';
}

/* ===== Players UI ===== */
function renderPlayers(filter=''){
  const t = document.getElementById('playersTable');
  t.innerHTML = '<tr><th>Name</th><th>Position</th><th>Age</th><th>Goals</th><th>Action</th></tr>';
  const role = currentUser.role || 'viewer';
  players.filter(p=>{
    if (!filter) return true;
    const s = filter.toLowerCase();
    return p.name.toLowerCase().includes(s) || (p.position || '').toLowerCase().includes(s);
  }).forEach(p=>{
    const tr = t.insertRow();
    tr.insertCell().textContent = p.name;
    tr.insertCell().textContent = p.position;
    tr.insertCell().textContent = p.age;
    tr.insertCell().textContent = p.goals;
    const actionCell = tr.insertCell();
    if (role === 'admin'){
      const del = document.createElement('button'); del.className='btn danger'; del.textContent='Delete';
      del.addEventListener('click', ()=> {
        if (!confirm('Delete ' + p.name + '?')) return;
        players = players.filter(x=>x.id !== p.id);
        save(STORAGE_KEYS.players, players);
        renderPlayers(document.getElementById('search').value);
        renderAll();
        toast('Player removed');
        soundDel();
      });
      actionCell.appendChild(del);
    } else {
      actionCell.innerHTML = '<span class="muted small">‚Äî</span>';
    }
  });
}

/* Add Player */
document.getElementById('addPlayerBtn').addEventListener('click', ()=>{
  if (!['admin','manager'].includes(currentUser.role)) { toast('Permission denied'); return; }
  const name = document.getElementById('p_name').value.trim();
  const position = document.getElementById('p_position').value.trim();
  const age = Number(document.getElementById('p_age').value || 0);
  const goals = Number(document.getElementById('p_goals').value || 0);
  if (!name || !position) { toast('Fill name and position'); return; }
  players.push({ id: uid(), name, position, age, goals });
  save(STORAGE_KEYS.players, players);
  document.getElementById('p_name').value=''; document.getElementById('p_position').value=''; document.getElementById('p_age').value=''; document.getElementById('p_goals').value='';
  renderPlayers();
  renderChart();
  renderAll();
  toast('Player added');
  soundAdd();
});
document.getElementById('resetPlayerBtn').addEventListener('click', ()=> {
  document.getElementById('p_name').value=''; document.getElementById('p_position').value=''; document.getElementById('p_age').value=''; document.getElementById('p_goals').value='';
});

/* Search + refresh */
document.getElementById('search').addEventListener('input', (e)=> renderPlayers(e.target.value));
document.getElementById('refreshPlayers').addEventListener('click', ()=> renderPlayers());

/* ===== Matches UI ===== */
function renderMatches(){
  const t = document.getElementById('matchesTable');
  t.innerHTML = '<tr><th>Date</th><th>Team A</th><th>Team B</th><th>Score</th><th>Action</th></tr>';
  const role = currentUser.role || 'viewer';
  matches.forEach(m=>{
    const tr = t.insertRow();
    tr.insertCell().textContent = m.date || '';
    tr.insertCell().textContent = m.teamA;
    tr.insertCell().textContent = m.teamB;
    tr.insertCell().textContent = m.score;
    const ac = tr.insertCell();
    if (['admin','manager'].includes(role)){
      const upd = document.createElement('button'); upd.className='btn'; upd.textContent='Edit';
      upd.addEventListener('click', ()=> {
        const newScore = prompt(`Set score for ${m.teamA} vs ${m.teamB}`, m.score || '-');
        if (newScore === null) return;
        m.score = newScore;
        save(STORAGE_KEYS.matches, matches);
        renderMatches();
        renderAll();
        toast('Match score updated');
      });
      ac.appendChild(upd);
    } else {
      ac.innerHTML = '<span class="muted small">‚Äî</span>';
    }
  });
}
document.getElementById('toggleAddMatch').addEventListener('click', ()=>{
  const wrap = document.getElementById('addMatchWrap'); wrap.style.display = wrap.style.display === 'none' ? 'block' : 'none';
});
document.getElementById('cancelAddMatch').addEventListener('click', ()=> document.getElementById('addMatchWrap').style.display = 'none');
document.getElementById('addMatchBtn').addEventListener('click', ()=>{
  if (!['admin','manager'].includes(currentUser.role)) { toast('Permission denied'); return; }
  const date = document.getElementById('m_date').value || nowISO();
  const a = document.getElementById('m_teamA').value.trim();
  const b = document.getElementById('m_teamB').value.trim();
  const s = document.getElementById('m_score').value.trim() || '-';
  if (!a || !b) return toast('Enter both teams');
  matches.push({ id: uid(), date, teamA: a, teamB: b, score: s });
  save(STORAGE_KEYS.matches, matches);
  document.getElementById('m_date').value=''; document.getElementById('m_teamA').value=''; document.getElementById('m_teamB').value=''; document.getElementById('m_score').value='';
  renderMatches();
  renderAll();
  toast('Match added');
});

/* ===== Settings: export/import/clear & export README ===== */
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const data = { players, matches, pom: POM, user: currentUser, logo: teamLogo };
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'wandoo-united-export.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});
document.getElementById('importBtn').addEventListener('click', ()=> document.getElementById('importFile').click());
document.getElementById('importFile').addEventListener('change', (e)=>{
  const f = e.target.files[0]; if (!f) return;
  const r = new FileReader(); r.onload = ()=>{
    try {
      const data = JSON.parse(r.result);
      if (data.players) players = data.players;
      if (data.matches) matches = data.matches;
      if (data.pom) { POM = data.pom; localStorage.setItem(STORAGE_KEYS.pom, POM); }
      if (data.logo) { teamLogo = data.logo; localStorage.setItem(STORAGE_KEYS.logo, teamLogo); renderLogo(); }
      save(STORAGE_KEYS.players, players); save(STORAGE_KEYS.matches, matches);
      toast('Imported data');
      renderAll();
    } catch(e){ toast('Import failed'); }
  }; r.readAsText(f);
});
document.getElementById('clearBtn').addEventListener('click', ()=>{
  if (!confirm('Clear all stored data? This cannot be undone.')) return;
  localStorage.removeItem(STORAGE_KEYS.players); localStorage.removeItem(STORAGE_KEYS.matches); localStorage.removeItem(STORAGE_KEYS.pom); localStorage.removeItem(STORAGE_KEYS.logo);
  players = []; matches = []; POM = null; teamLogo = null; currentUser = { username: 'Guest', role: 'viewer' };
  save(STORAGE_KEYS.user, currentUser);
  renderLogo(); refreshAuthUI(); renderAll(); toast('Cleared');
});

// Export README file (short)
document.getElementById('exportReadmeBtn').addEventListener('click', ()=>{
  const readme = `# Wandoo United FC ‚Äî Football Club Management System (Single-file)

This repository contains a single file: \`index.html\`, a modern dashboard-style football club management demo that runs entirely in the browser (no backend required).

## Features
- Modern dashboard UI (charts, cards)
- Admin / Manager / Viewer roles (client-side demo)
- Player CRUD (add, delete ‚Äî role-based)
- Match schedule + update scores
- Player of the Month selection
- Upload team logo (stored in browser)
- Toast notifications and subtle sound effects
- Data persistence via localStorage
- Export/import JSON and export README buttons

## How to install (on GitHub)
1. Create or open repository (e.g. \`football-club-system\`).
2. Add a file named \`index.html\`.
3. Paste the entire HTML from this file into \`index.html\`.
4. Commit with message:
   \`Added Wandoo United FC dashboard version\`
5. Visit:
   \`https://<your-username>.github.io/football-club-system/\`

## Demo users (client-only)
- admin / 1234 ‚Äî full access
- manager / 5678 ‚Äî add players, edit matches (no delete)
- viewer / 0000 ‚Äî read-only

## Notes
- This is a client-side demo. For production, move authentication and storage to a secure backend.
- You can export data (JSON) and import it on another device.

Enjoy ‚Äî Wandoo United FC!`;

  const blob = new Blob([readme], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'README-Wandoo-United-FC.txt'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  toast('README exported');
});

/* ===== POM selection ===== */
function renderPOMList(){
  const el = document.getElementById('pomList'); el.innerHTML = '';
  players.forEach(p=>{
    const b = document.createElement('button'); b.className='btn ghost'; b.textContent = p.name + ' (' + p.goals + ')';
    b.addEventListener('click', ()=>{
      if (currentUser.role !== 'admin'){ toast('Only admin may set Player of the Month'); return; }
      POM = p.name; localStorage.setItem(STORAGE_KEYS.pom, POM); renderAll(); toast('POM set: ' + POM);
    });
    el.appendChild(b);
  });
}
document.getElementById('autoPOM').addEventListener('click', ()=> {
  if (players.length === 0) return toast('No players');
  const top = players.slice().sort((a,b)=>b.goals - a.goals)[0];
  POM = top.name; localStorage.setItem(STORAGE_KEYS.pom, POM); renderAll(); toast('Auto POM: ' + POM);
});
document.getElementById('clearPOM').addEventListener('click', ()=> { POM = null; localStorage.removeItem(STORAGE_KEYS.pom); renderAll(); toast('POM cleared'); });
document.getElementById('autoPomBtn').addEventListener('click', ()=> document.getElementById('autoPOM').click());
document.getElementById('clearPomBtn').addEventListener('click', ()=> document.getElementById('clearPOM').click());

/* ===== Chart.js for goals per player ===== */
let chart = null;
function renderChart(){
  const ctx = document.getElementById('goalsChart').getContext('2d');
  const labels = players.map(p=>p.name);
  const data = players.map(p=>p.goals || 0);
  if (chart) { chart.data.labels = labels; chart.data.datasets[0].data = data; chart.update(); return; }
  chart = new Chart(ctx, {
    type: 'bar',
    data: { labels, datasets: [{ label: 'Goals', data, backgroundColor: 'rgba(45,212,191,0.9)', borderRadius:6 }]},
    options: {
      responsive:true, maintainAspectRatio:false,
      scales:{ x:{ ticks:{ color:'#dffaf0' } }, y:{ ticks:{ color:'#dffaf0' }, beginAtZero:true } },
      plugins:{ legend:{ display:false } }
    }
  });
}

/* ===== Render everything ===== */
function renderAll(){
  save(STORAGE_KEYS.players, players);
  save(STORAGE_KEYS.matches, matches);
  if (localStorage.getItem(STORAGE_KEYS.pom)) POM = localStorage.getItem(STORAGE_KEYS.pom);
  renderPlayers(document.getElementById('search').value || '');
  renderMatches();
  renderChart();
  renderPOMList();
  document.getElementById('cardPlayers').textContent = players.length;
  const totalGoals = players.reduce((s,p)=>s + Number(p.goals||0),0);
  document.getElementById('cardGoals').textContent = totalGoals;
  document.getElementById('cardPOM').textContent = POM || '‚Äî';
  renderLogo();
  refreshAuthUI();
}

/* Boot */
(function boot(){
  if (localStorage.getItem(STORAGE_KEYS.pom)) POM = localStorage.getItem(STORAGE_KEYS.pom);
  if (localStorage.getItem(STORAGE_KEYS.logo)) teamLogo = localStorage.getItem(STORAGE_KEYS.logo);
  refreshAuthUI();
  renderAll();
  document.getElementById('loginOpenBtn').addEventListener('click', ()=> { document.querySelector('html,body').scrollTop = 0; document.getElementById('loginUser').focus(); });
  showSection('dashboard');
})();
</script>
</body>
        </html>
